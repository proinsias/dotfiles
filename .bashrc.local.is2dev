# Non-interactive stuff here

# added by Anaconda3 2.5.0 installer
#export PATH="/home/fodonovan/anaconda3/bin:$PATH"

#
## Devbox Maintenance - from chaps_functions
#

is2update() {
    local wd=$(pwd);
    local helptext="${red}is2update${reset}\nis2update executes a 'git pull origin develop' in is_engine (and does a twh), configuration, is_service, and is_tools\n${blue}Usage:${reset}\n\t-h\t\t\t\tPrints this help text\n";

    if [ "$1" == "-h" ]; then
        echo -e $helptext
    else
        source is2dev_conda.sh sys

        echo "${red}Pulling is_engine ${blue}[development branch]${reset}";
        cd /usr/local/insightsquared/is_engine;
        git checkout develop;
        git pull;
	      bbase/manage.py migrate;
	      npm install;
	      gulp;
        #touch /usr/local/insightsquared/is_engine/bbase/wsgi_handler.py;
        sudo /etc/init.d/gunicorn restart

        echo "${red}Pulling configuration ${blue}[master branch]${reset}";
        cd /usr/local/insightsquared/configuration;
        git checkout master;
        git pull;
        echo "${red}Pulling is_tools ${blue}[master branch]${reset}";
        cd /usr/local/insightsquared/is_tools/;
        git checkout master;
        git pull;
        echo "${red}Pulling is_service ${blue}[master branch]${reset}";
        cd /usr/local/insightsquared/is_service/;
        git checkout master;
        git pull;
        echo "${red}Pulling forecastv6 ${blue}fv6-prod branch]${reset}";
        cd /usr/local/insightsquared/forecastv6/;
        git checkout fv6-prod;
        git pull;
        echo "${red}Returning to execution directory. Thanks for keeping your devbox happy :)${reset}";
        cd $wd;
        source is2dev_conda.sh deactivate
    fi
}

export -f is2update

# If not running interactively, stop here
if [[ "$-" == *i* ]]; then
  eval $(keychain --eval --agents ssh,gpg --inherit any fodonovan.pem 9DE94ABA)
fi
